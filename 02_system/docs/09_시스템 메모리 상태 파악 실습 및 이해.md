# 시스템 메모리 상태 파악 실습 및 이해


`free -h`의 **buff/cache**는 “지금 앱이 쓰는 메모리”가 아니라,

**디스크를 빠르게 쓰려고 커널이 잠깐 잡고 있는 캐시**야.

→ 필요하면 **바로 비워서 앱에 내줄 수 있음**.

# 뭐가 들어있는데?

- **Buffers**: 디스크 쓰기/읽기용 **메타데이터 버퍼**(블록 I/O).
    - **Buffers 는 파일 정보 (inode block 등)**
- **Cached**: 파일 **내용**을 담는 **페이지 캐시**.
    - **Cached 는 파일 내용 (data block)**

> anonymous page = 파일과 연결되지 않은 순수한 프로세스 메모리 페이지
> 
- 힙 / 스택 / malloc → anonymous
- 파일 캐시 / 실행 파일 → file-backed

![image.png](../images/09_1.png)

---

# 의미

# Linux 캐시 & inode / data 정리

## 1️⃣ drop_caches 정리

| 명령 | 비우는 것 | 줄어드는 지표 |
| --- | --- | --- |
| `echo 1 > drop_caches` | **Page Cache** (파일 내용) | `free -h` → **Cached** |
| `echo 2 > drop_caches` | **dentry + inode 캐시** | `/proc/meminfo` → **SReclaimable** |
| `echo 3 > drop_caches` | 위 **둘 다** | Cached + SReclaimable |
- ❌ 프로세스 메모리(힙/스택/anonymous page) **안 건드림**
- ⭕ 디스크 I/O 줄이기 위한 **커널 캐시만 정리**
- 정리 후 I/O 발생 시 **다시 채워짐**

---

## 2️⃣ 캐시 종류 한 줄 요약

| 캐시 | 내용 |
| --- | --- |
| **Page Cache** | 파일의 **실제 내용(data block)** |
| **inode 캐시** | 파일의 **메타데이터** |
| **dentry 캐시** | 파일 **이름 ↔ inode 번호** 매핑 |

---