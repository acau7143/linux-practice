# 시스템 메모리 상태 파악 실습 및 이


`free -h`의 **buff/cache**는 “지금 앱이 쓰는 메모리”가 아니라,

**디스크를 빠르게 쓰려고 커널이 잠깐 잡고 있는 캐시**야.

→ 필요하면 **바로 비워서 앱에 내줄 수 있음**.

# 뭐가 들어있는데?

- **Buffers**: 디스크 쓰기/읽기용 **메타데이터 버퍼**(블록 I/O).
    - **Buffers 는 파일 정보 (inode block 등)**
- **Cached**: 파일 **내용**을 담는 **페이지 캐시**.
    - **Cached 는 파일 내용 (data block)**
    

![image.png](../images/09_1.png)

---

# 의미

- `echo 1 > ...drop_caches` → **페이지 캐시(Page cache)**만 비움 → `free -h`의 **Cached**가 줄어듦.
- `echo 2 > ...drop_caches` → **dentry/inode 캐시(슬랩의 회수 가능분)**만 비움 → **SReclaimable**(슬랩)이 주로 줄어듦.
- `echo 3 > ...drop_caches` → 위 둘 **모두** 비움.

> ※ 앱이 쓰는 실제 메모리는 안 건드려. 캐시만 정리하고, 곧 다시 채워짐.
> 

---

- **inode 블록**: 파일의 **설명서**. 권한/소유자/크기/시간값 + **데이터가 어디에 있는지(포인터·extent)** 정보를 가짐. *파일 이름은 없음!*
- **data 블록**: 파일의 **진짜 내용(바이트)** 이 들어있는 블록. 디렉터리라면 “이름 ↔ inode번호” 목록이 여기에 저장됨.

---

# 그림으로

```
[디렉터리의 data 블록]  ──(이름→inode번호)──▶ [inode 블록] ──(포인터/extent)──▶ [파일의 data 블록들]
           "foo" ──▶ 12345                     inode 12345                         실제 바이트 데이터

```

# 현장 확인 명령

```bash
ls -li file.txt        # inode 번호 보기 (이름은 디렉터리 data블록에, 속성은 inode에)
stat file.txt          # inode, 블록 수, 시간값 등 메타데이터
df -h ; df -i          # 용량(데이터 블록)과 inode 소모 각각 확인

```

